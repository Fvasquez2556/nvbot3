# ğŸ“‹ Instrucciones de Uso - Validador CSV NvBot3

## ğŸš€ CÃ³mo Ejecutar el Validador

### **Paso 1: PreparaciÃ³n**
```bash
# 1. Activar entorno virtual (CRÃTICO)
nvbot3_env\Scripts\activate  # Windows
# source nvbot3_env/bin/activate  # Linux/Mac

# 2. Navegar al directorio del proyecto
cd nvbot3

# 3. Guardar el script como: scripts/validate_csv_format.py
```

### **Paso 2: EjecuciÃ³n BÃ¡sica**
```bash
# Ejecutar validaciÃ³n completa
python scripts/validate_csv_format.py
```

### **Paso 3: Revisar Resultados**
El script genera:
- **Console output**: Progreso en tiempo real
- **csv_validation_report.log**: Log detallado 
- **csv_validation_detailed_report.json**: Reporte tÃ©cnico completo

---

## ğŸ“Š InterpretaciÃ³n de Resultados

### **âœ… RESULTADO IDEAL:**
```
ğŸ“Š REPORTE FINAL DE VALIDACIÃ“N CSV
===============================
ğŸ“ Total archivos analizados: 150
âœ… Archivos vÃ¡lidos: 150
âš ï¸ Archivos con problemas: 0
ğŸš¨ Errores crÃ­ticos: 0
ğŸ“ˆ Tasa de Ã©xito: 100.0%

ğŸ¤– COMPATIBILIDAD PARA ENTRENAMIENTO:
ğŸ”§ Feature Calculator listos: 150/150
ğŸ¯ Target Creator listos: 150/150
ğŸš€ Listos para entrenamiento: 150/150

ğŸ‰ Â¡TODOS LOS ARCHIVOS ESTÃN LISTOS PARA ENTRENAMIENTO!
```

### **âš ï¸ PROBLEMAS TÃPICOS Y SOLUCIONES:**

#### **Problema 1: Columnas Faltantes**
```
âŒ missing_columns: Columnas faltantes: ['volume', 'close_time']
```
**SoluciÃ³n**: Re-descargar archivos con downloader actualizado

#### **Problema 2: Datos Insuficientes**
```
âŒ insufficient_data_for_features: 150 < 200 perÃ­odos
```
**SoluciÃ³n**: Descargar mÃ¡s datos histÃ³ricos (perÃ­odo mÃ¡s largo)

#### **Problema 3: Gaps Temporales**
```
âš ï¸ temporal_gaps: 15 gaps grandes detectados
```
**SoluciÃ³n**: Verificar conectividad durante descarga, rellenar gaps

#### **Problema 4: Precios InvÃ¡lidos**
```
âŒ invalid_ohlc_relationships: 25 registros con relaciones OHLC invÃ¡lidas
```
**SoluciÃ³n**: Verificar fuente de datos, re-descargar archivos afectados

#### **Problema 5: Formato Timestamp**
```
âŒ timestamp_format: Formato de timestamp no vÃ¡lido
```
**SoluciÃ³n**: Convertir timestamps a formato estÃ¡ndar (ISO o epoch)

---

## ğŸ”§ Acciones Correctivas AutomÃ¡ticas

### **Script de CorrecciÃ³n RÃ¡pida** (Opcional)
```python
# Agregar al final del validador principal:

def fix_common_issues(csv_file: str):
    """Corregir problemas comunes automÃ¡ticamente."""
    df = pd.read_csv(csv_file)
    
    # 1. Convertir timestamps
    df['timestamp'] = pd.to_datetime(df['timestamp'])
    
    # 2. Rellenar gaps pequeÃ±os (forward fill)
    df = df.sort_values('timestamp')
    df = df.fillna(method='ffill', limit=2)
    
    # 3. Remover outliers extremos
    for col in ['open', 'high', 'low', 'close']:
        Q1 = df[col].quantile(0.01)
        Q3 = df[col].quantile(0.99)
        df = df[(df[col] >= Q1) & (df[col] <= Q3)]
    
    # 4. Guardar archivo corregido
    df.to_csv(csv_file.replace('.csv', '_fixed.csv'), index=False)
    print(f"âœ… Archivo corregido: {csv_file}_fixed.csv")
```

---

## ğŸ“ˆ MÃ©tricas de Calidad EspecÃ­ficas

### **Para Feature Calculator:**
- âœ… **MÃ­nimo 200 perÃ­odos** para indicadores largos (SMA 200)
- âœ… **<5% valores NaN** en OHLCV
- âœ… **Datos continuos** sin gaps grandes

### **Para Target Creator:**
- âœ… **PerÃ­odos futuros suficientes**:
  - 5m: â‰¥48 perÃ­odos adelante (4h momentum)
  - 15m: â‰¥16 perÃ­odos adelante (4h momentum)  
  - 1h: â‰¥4 perÃ­odos adelante (4h momentum)
- âœ… **â‰¥1000 perÃ­odos utilizables** despuÃ©s de lookforward
- âœ… **Precios de cierre continuos** para calcular cambios

### **Para Model Trainer:**
- âœ… **Formato consistente** entre archivos
- âœ… **Sin errores crÃ­ticos** en validaciÃ³n
- âœ… **Temporal splits posibles** (mÃ­nimo 70% para train)

---

## ğŸ¯ Casos de Uso EspecÃ­ficos

### **Caso 1: ValidaciÃ³n DespuÃ©s de Descarga**
```bash
# DespuÃ©s de descargar datos nuevos
python scripts/download_historical_data.py
python scripts/validate_csv_format.py
```

### **Caso 2: ValidaciÃ³n Pre-Entrenamiento**
```bash
# Antes de ejecutar Model Trainer
python scripts/validate_csv_format.py
if [ $? -eq 0 ]; then
    python scripts/model_trainer.py
else
    echo "âŒ Corregir datos antes del entrenamiento"
fi
```

### **Caso 3: ValidaciÃ³n de Archivos EspecÃ­ficos**
```python
# Validar solo archivos de un sÃ­mbolo
validator = CSVFormatValidator()
btc_files = [f for f in os.listdir('data/raw') if f.startswith('BTCUSDT')]
for file in btc_files:
    result = validator._validate_single_file(Path(f'data/raw/{file}'))
    print(f"{file}: {'âœ… VÃ¡lido' if result['is_valid'] else 'âŒ Problemas'}")
```

---

## ğŸ’¡ Recomendaciones Finales

### **ğŸ”„ Ejecutar Regularmente:**
- **DespuÃ©s de cada descarga** de datos nuevos
- **Antes de entrenar modelos** nuevos
- **Semanalmente** como mantenimiento

### **ğŸ“Š Monitorear MÃ©tricas:**
- **Success rate â‰¥95%** para entrenamiento confiable
- **Training ready = Total files** para pipeline completo
- **Zero critical errors** obligatorio antes de Model Trainer

### **ğŸš¨ Alertas CrÃ­ticas:**
Si ves estos errores, **DETENER** entrenamiento:
- `missing_columns` con columnas OHLCV
- `insufficient_data_for_features`
- `invalid_ohlc_relationships` >1% de datos
- `temporal_order` desordenado

### **âœ… Estado Ideal:**
```
ğŸ‰ VALIDACIÃ“N EXITOSA: Todos los archivos listos para entrenamiento
ğŸ”§ Feature Calculator: 150/150 archivos listos
ğŸ¯ Target Creator: 150/150 archivos listos  
ğŸš€ Model Trainer: LISTO PARA EJECUTAR
```

**Â¡Con este validador tu NvBot3 tendrÃ¡ datos de calidad garantizada para detectar momentum, rebotes y regÃ­menes con mÃ¡xima precisiÃ³n!** ğŸš€